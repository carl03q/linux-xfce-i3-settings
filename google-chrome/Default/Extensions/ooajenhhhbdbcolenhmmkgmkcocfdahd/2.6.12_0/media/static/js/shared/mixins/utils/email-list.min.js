function Email(b,a){this.name=a||"";this.email=b||""}Email.apply=function(a){this.name=a.name;this.email=a.email;return this};Email.method("toJson",function(){return{name:this.name,email:this.email}});function EmailList(a){this.COOKIE="tb-emails";this.ORDER_COOKIE="tb-emails-order";this.uber("_init",a)}EmailList.inherits(ServerCommunication);EmailList.method("push",function(c,b,a){var e=this;var d={emailJson:JSON.stringify({lookup:e.getLookup(),order:e.getAll()})};this._accessWebsite("push",Account.id(),Account.key(),d,c,b,a)});EmailList.method("pull",function(c,b,a){this._accessWebsite("pull",Account.id(),Account.key(),{},function(f,d){var e=JSON.parse(d.data.emailJson);f.updateLookup(e.lookup);f.updateOrder(e.order);c?c(f):false},b,function(e,d){a?a(e):false})});EmailList.method("addEmails",function(e){var d=this.getLookup();var b=this.getAll();for(var c=0;c<e.length;c++){var a=this._addEmail(d,b,e[c]);d=a.lookup;b=a.order}this.updateOrder(b);this.updateLookup(d);this.push()});EmailList.method("addEmail",function(c,b){var e=this.getLookup();var a=this.getAll();var d=this._addEmail(e,a,c,b);this.updateOrder(d.order);this.updateLookup(d.lookup);this.push()});EmailList.method("_addEmail",function(h,a,d,c){var e=(new Email(d,c)).toJson();if(!(d in h)){var g=(c?c:d).toLowerCase();var f="";var b=0;for(b=0;b<a.length;b++){f=(a[b].name?a[b].name:a[b].email).toLowerCase();if(g<=f){break}}a.splice(b,0,e);h[d]=true}return{order:a,lookup:h}});EmailList.method("removeEmail",function(c){var d=this.getLookup();delete d[c];this.updateLookup(d);var a=this.getAll();var b=this.indexOf(c,a);a.splice(b,1);this.updateOrder(a);this.push()});EmailList.method("indexOf",function(b,a){a=a||this.getAll();for(var c=0;c<a.length;c++){if(a[c].email===b){return c}}return -1});EmailList.method("updateName",function(c,b){var a=this.getAll();a[this.indexOf(c,a)].name=b;this.updateOrder(a)});EmailList.method("deleteAll",function(){DB.eraseLocalStorage(this.ORDER_COOKIE);DB.eraseLocalStorage(this.COOKIE)});EmailList.method("updateLookup",function(a){DB.insertLocalStorage(this.COOKIE,JSON.stringify(a))});EmailList.method("updateOrder",function(a){DB.insertLocalStorage(this.ORDER_COOKIE,JSON.stringify(a))});EmailList.method("getLookup",function(){try{return JSON.parse(DB.readLocalStorage(this.COOKIE)||"{}")}catch(a){return{}}});EmailList.method("getAll",function(){try{return JSON.parse(DB.readLocalStorage(this.ORDER_COOKIE)||"[]")}catch(a){return[]}});var EmailListHandler=new EmailList("contacts");