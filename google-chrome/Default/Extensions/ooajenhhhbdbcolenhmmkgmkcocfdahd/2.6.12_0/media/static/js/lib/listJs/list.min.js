var KeysRequiredException={name:"Keys Required",level:"Pretty Bad",message:"If Twitter's typeahead is used, then keys are required.",htmlMessage:"If Twitter's typeahead is used, then keys are required.",toString:function(){return this.name+": "+this.message}};var ListJS=function(a,b,d,c){c=c||{};c.typeahead=c.typeahead||{};c={starting_count:c.starting_count||2,delete_class:c.delete_class||".delete",value_class:c.value_class||".value",maximum:c.maximum||0,auto_add:c.auto_add||true,prevent_auto_add:c.prevent_auto_add||[],typeahead:{suggestions:c.typeahead.suggestions||[],suggestion:c.typeahead.suggestion||false,keys:c.typeahead.keys||[],displayKey:c.typeahead.displayKey||"",name:c.typeahead.name||""}};if(c.suggestion&&!c.keys.length===0){throw KeysRequiredException}return{html:a.html(),count:0,suggestions:c.typeahead.suggestions,_substringMatcher:function(e,f){var h=this;return function g(l,i){var k,j;k=[];j=new RegExp(l,"i");$.each(h.suggestions,function(n,o){for(var n=0;n<f.length;n++){var m=f[n];if(j.test(o[m])){k.push(o);return}}});i(k)}},addSuggestions:function(e){this.suggestions=this.suggestions.concat(e)},setupTypeahead:function(e){var f=this;e.typeahead({hint:true,highlight:true,minLength:1},{name:c.typeahead.name,displayKey:c.typeahead.displayKey,templates:{suggestion:function(g){return c.typeahead.suggestion(g)}},source:f._substringMatcher(f.suggestions,c.typeahead.keys)})},addElement:function(){var g=this;var e=$(this.html).attr("element",this.count);d.append(e);if(c.auto_add){var f=undefined;$(document).mousedown(function(h){f=$(h.target)});e.blur(function(){setTimeout(function(){var h=f?f.attr("id"):"";if(c.prevent_auto_add.indexOf(h)===-1&&e.val()&&e.attr("element")==="{0}".format(g.count-1)){b.click()}},150)})}if(c.suggestion!==false){g.setupTypeahead(e)}e.focus();this.count++},getResults:function(){var e=$(c.value_class).map(function(g,f){var h=$(f).val();if(h){return h}});e.join=[].join;return e},reset:function(){d.html("");this.setup();this.count=0},setup:function(){for(var e=0;e<c.starting_count;e++){b.click()}},start:function(){var e=this;b.click(function(){if(!c.maximum||e.count<c.maximum){e.addElement()}});a.remove();this.setup()}}};