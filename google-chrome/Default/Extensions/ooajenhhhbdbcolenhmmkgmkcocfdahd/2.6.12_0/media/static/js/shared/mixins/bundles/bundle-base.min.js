function BundleBase(c,b,a,d){this._init(c,b,a,d)}BundleBase.method("_init",function(c,b,a,d){this.bundleName=c;this.bundleId=a||0;this.link=d||"";this.tabs=b||[]});BundleBase.method("length",function(){return this.tabs.length});BundleBase.method("removeTab",function(c,b){for(var a=0;a<this.length();a++){if(this.tabs[a].id===c){this.tabs.splice(a,1);if(b){TBAccessor.updateBundle(this.bundleName,this.getJson())}return true}}return false});BundleBase.method("hasTabs",function(){return this.length()>0});BundleBase.method("addTabs",function(a,b){var c=this;var a=isArray(a)?a:[a];this.tabs=this.tabs.concat(a);if(b){TBAccessor.updateBundle(c.bundleName,this.getJson())}});BundleBase.method("addUrls",function(a){a=(isArray(a)?a:[a]).map(function(b){return TabBase.apply(b)});this.tabs=this.addTabs(a)});BundleBase.method("hide",function(a,c,b){if(!this.isHidden()){TBAccessor.hide(this.bundleName,this.isSynced());a?a():false;if(this.isSynced()){TBSynchronizer.hide(Account.id(),this.bundleName,Account.key(),c,b)}return true}return false});BundleBase.method("unhide",function(a,c,b){if(this.isHidden()){TBAccessor.unhide(this.bundleName);a?a():false;if(this.isSynced()){TBSynchronizer.show(Account.id(),this.bundleName,Account.key(),c,b)}return true}return false});BundleBase.method("remove",function(c,e,b,d,a){TBAccessor.removeBundle(this.bundleName);if(!c){this.stopSyncing(e,b);this.unsubscribe(d,a)}});BundleBase.method("stopSyncing",function(b,a){if(this.isSynced()){TBSynchronizer.remove(Account.id(),this.bundleName,Account.key(),b,a)}});BundleBase.method("unsubscribe",function(b,a){if(this.isShared()){SubscriptionHandler.remove(Account.id(),Account.key(),SubscriptionHandler.getBundle(this.bundleName).id)}});BundleBase.method("update",function(){TBAccessor.updateBundle(this.bundleName,this.getJson())});BundleBase.method("save",function(){TBAccessor.saveBundle(this.bundleName,this.getJson())});BundleBase.method("updateName",function(b,e,d,a){if(b!==this.bundleName){var c=Success;if(TBAccessor.bundleExists(b)){c=Failure.DuplicateName;a(c)}else{TBAccessor.renameBundle(this.bundleName,b);if(this.isSynced()){TBSynchronizer.rename(Account.id(),this.bundleName,Account.key(),b,e,d,function(){a(c)});this.bundleName=b}else{this.bundleName=b;a(c)}}}});BundleBase.method("updateLinks",function(a,g,f,e,d,c,b){if(Account.loggedIn()){var h=this;this._checkBundleLimit(function(){h._updateSynchronization(g,f,e);h._updateSubscription(d,c,b)},a)}});BundleBase.method("updateDescription",function(c,b,a){if(this.isSynced()){Share.editDescription(Account.id(),Account.key(),this.bundleName,this._cleanseDescription(c),function(d){b?b(d.description):false},function(d){a?a(d):false})}});BundleBase.method("updateLink",function(b,c,a){if(b!==this.link){Share.editLink(Account.id(),Account.key(),this.bundleName,b,function(d){c?c(d.link):false},function(d){a?a(d):false})}});BundleBase.method("getJson",function(){return this.tabs.map(function(a){return a.toObject()})});BundleBase.method("getJsonString",function(){return JSON.stringify(this.getJson())});BundleBase.method("fill",function(){this.tabs=TBAccessor.getBundleJSON()[this.bundleName].map(this.createFillCB())});BundleBase.method("hasChanged",function(){return JSON.stringify(TBAccessor.getURLList(this.bundleName))!==this.getJsonString()});BundleBase.method("createFillCB",function(){var a=this;return function(b){return TabBase.apply(b,a)}});BundleBase.method("isShared",function(){return SubscriptionHandler.isShared(this.bundleName)});BundleBase.method("isSynced",function(){return TBSynchronizer.isSynced(this.bundleName)});BundleBase.method("isHidden",function(){return TBAccessor.isHidden(this.bundleName)});BundleBase.method("_updateSynchronization",function(c,b,a){if(!this.isShared()){TBSynchronizer.push(Account.id(),this.bundleName,Account.key(),this.getJsonString(),c,b,a)}});BundleBase.method("_updateSubscription",function(c,b,a){if(this.isShared()){SubscriptionHandler.push(Account.id(),Account.key(),this.bundleName,this.getJsonString(),c,b,a)}});BundleBase.method("_checkBundleLimit",function(c,b){if(this._isLocal()){var a=Account.bundleLimit();if(TBSynchronizer.length()>=a){return b?b():false}}c?c():false});BundleBase.method("_cleanseDescription",function(a){return a.replace("<script>","").replace("<\/script>","").replace("</iframe>","").replace("<iframe>","").replace("</style>","").replace("<style>","")});BundleBase.method("_isNewlyUpdated",function(){return SubscriptionHandler.isNewlyUpdated(this.bundleName)});BundleBase.method("_isNewBundle",function(){return !TBAccessor.bundleExists(this.bundleName)});BundleBase.method("_isLocal",function(){return !(this.isSynced()||this.isShared())});