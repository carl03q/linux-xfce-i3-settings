function EmailPage(a,b){this._init("#email-container",".tb-page","#tab-bundler-container",a,b);this.$emailContainer=$("#email-list-container");this.sortingHtmlTemplate="<span class='left pointer sorting-letter' letter='{0}'>{0}</span>";this.renderEmailWithName="{0} &lt{1}&gt";this.emailHtml=["<div class='contacts-email left' email='{2}' letter='{1}'>","<div class='left identity' title='{2}'>{0}</div>","<div class='left action-container' hidden>","<div class='pointer remove_link right image' title='{0}' email='{2}'> </div>","</div>","</div>"].join("\n");this.addEmailList=ListJS($("#add-email"),$("#add-email-button"),$("#add-email-container"),{maximum:10,starting_count:1,prevent_auto_add:["confirm-email","cancel-email","add-email-button"]});this.started=false}EmailPage.inherits(Page);EmailPage.method("toggle",function(a,b){var c=this;this.uber("_toggle",function(){Mousetrap.pause();if(!c.started){EmailListHandler.pull(function(){},function(d){if(Failure.ContactsNotFound.equals(d)){EmailListHandler.push()}},function(){c.start();c.started=true})}c.highlightEven()},function(){Mousetrap.unpause()})});EmailPage.method("addEmail",function(b,a){EmailListHandler.addEmail(b,a);sharePage.addToAutocomplete(new Email(b,a));this.displayEmail(b,a)});EmailPage.method("displayEmail",function(c,b){var a=b?this.renderEmailWithName.format(b,c):c;this.$emailContainer.append(this.emailHtml.format(a,a[0].toLowerCase(),c))});EmailPage.method("deleteEmail",function(a){a.remove();EmailListHandler.removeEmail(a.attr("email"))});EmailPage.method("highlightEven",function(){$(".contacts-email").removeClass("even-contacts-email");$(".contacts-email:visible:even").addClass("even-contacts-email")});EmailPage.method("setup",function(){if(!Account.loggedIn()){$(".email-page-toggler").hide()}this.bind("logout",function(){EmailListHandler.deleteAll();$(".email-page-toggler").hide()});this.bind("login",function(){$(".email-page-toggler").show()})});EmailPage.method("start",function(){var c=this;this.addEmailList.start();this.emailList=EmailListHandler.getAll();this.sortingHtml=[];for(var b=97;b<=122;b++){this.sortingHtml.push(this.sortingHtmlTemplate.format(String.fromCharCode(b)))}$("#sorting-container").append(this.sortingHtml.join("<span class='middot left'>&middot</span>"));$(".sorting-letter").click(function(){$(".contacts-email").hide();$('.contacts-email[letter="{0}"]'.format($(this).attr("letter"))).fadeIn(300,function(){c.highlightEven()})});$(".sorting-letter").click(function(){$(".contacts-email").hide();$('.contacts-email[letter="{0}"]'.format($(this).attr("letter"))).fadeIn(300,function(){c.highlightEven()})});$("#add-contact").click(function(){$("html, body").animate({scrollTop:$(document).height()},"slow")});$("#show-all-contacts").click(function(){$(".contacts-email").show();c.highlightEven()});$(".sorting-letter,#show-all-contacts,#add-contact").hover(function(){$(this).addClass("highlight")},function(){$(this).removeClass("highlight")});for(var b=0;b<this.emailList.length;b++){var a=this.emailList[b];this.displayEmail(a.email,a.name)}c.highlightEven();$(".email").find(".remove_link").click(function(){c.deleteEmail($(".contacts-email[email='{0}']".format($(this).attr("email"))))});$("#confirm-email").click(function(){var d=$("#email-list-name").val();var e=c.addEmailList.getResults().join();c.addEmailList.reset();c.addEmail(e,d);$("#email-list-name").val("");c.highlightEven()});$("#cancel-email").click(function(){var d=$("#email-list-name").val("");c.addEmailList.reset()});$(".contacts-email").find(".remove_link").click(function(){c.deleteEmail($(this).parents(".contacts-email"));c.highlightEven()});$(".contacts-email").hover(function(){$(this).find(".action-container").show()},function(){$(this).find(".action-container").hide()})});var emailPage=new EmailPage(".email-page-toggler","email-page-event");emailPage.setup();