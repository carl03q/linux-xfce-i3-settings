function Bundle(a,b){this._init(a,b)}Bundle.inherits(BundleBase);Bundle.method("_init",function(a,b){this.bundleHtml="<li id='{2}' class='single-bundle-container' bundleName='{0}'>                       <div class='row bundle tb-text image' editing='false' name='{0}'>                         <div class='bundle_icon {5} image' editing='false' title='Open bundle!'> </div>                         <div class='bundle_name'>                           <span class='bundle_name_html'>                             <span class='bundle_name_display bundle_name_edit'>{1}</span>                             <input class='bundle_name_input bundle_name_edit' hidden/>                             <span class='mini-text bundle_name_edit'> (<span class='bundle_length'><span {10}>NEW: </span>{4}</span> tabs) </span>                           </span>                           <span class='hotkey_id' hidden> {7} </span>                         </div>                         <div class='show edit_highlight image hidden' editing='false'> </div>                         <div class='icons hidden'>                           <div class='add_page icon image right' title='Add Tab'> </div>                           {9}                           {8}                           {6}                         </div>                       </div>                       <div class='link_container hidden' name='{0}'>                         <div class='hidden-icon-container center'>                           <i class='pointer refresh fa fa-refresh hidden-icon' title='Refresh Bundle'/>                            {11}                           {12}                           <i class='pointer remove hidden-icon fa fa-trash' title='Delete'> </i>                          </div>                         {3}                         <div class='add_link_container image'>                           <input class='input_link' default=\"URL or 1,1-4,7 or ALL.\" type='text'/>                           <div class='manual_add_page image right'> </div>                         </div>                       </div>                     </li>";this.makeLinkHtml="<div class='make-link icon image right' title='Share' {0}> </div>";this.pushBundleButtonHtml="<div class='push icon image right' title='Sync'> </div>";this.showBundleButtonHtml="<div class='show-bundle toggle-hide icon image right' title='Un-Archive'> </div>";this.hideBundleButtonHtml="<div class='hide-bundle toggle-hide icon image right' title='Archive'> </div>";this.toggleAutosaveHtml="<i class='pointer selected autosave fa fa-buysellads hidden-icon {0}' title='Turn Off Autosave'/> <i class='pointer autosave fa fa-buysellads hidden-icon {1}' title='Turn On Autosave'/>";this.downloadBundleCsvHtml=Options.isset(Options.AllowExportToCsv)?"<i class='pointer export-csv fa fa-file-excel-o hidden-icon' title='Export to Csv'/>":"";if(Autosave.isTarget(a)){this.toggleAutosaveHtml=this.toggleAutosaveHtml.format("","hidden")}else{this.toggleAutosaveHtml=this.toggleAutosaveHtml.format("hidden","")}this.id="tb-{0}".format(base64Encode(a).replace(/[=+/]/g,""));this.hotkeyId=b;this.$bundle;this.$add_link_container;this.uber("_init",a)});Bundle.method("stopSyncing",function(){var a=this;this.uber("stopSyncing",function(){a.$bundle.find(".bundle_icon").removeClass("is-synced");a.$bundle.find(".make-link").hide()},function(b){Popup.show(Messages.GeneralErrorTitle,b.message)})});Bundle.method("highlightHotkey",function(){var b=this.$bundle.find(".bundle_name_html");var a=this.$bundle.find(".hotkey_id");b.hide();a.show();setTimeout(function(){b.show();a.hide()},2000)});Bundle.method("removeTab",function(a){this.uber("removeTab",a,true);this.updateBundleLengthDisplayed();if(this.isSynced()||this.isShared()){this.updateLinks()}});Bundle.method("makeHtml",function(){var b=this.tabs.map(function(e){return e.makeTabHTML()});var d=b.join("");var c=this.isSynced()||this.isShared()?"is-synced":"";var a=this.isShared()?"":this.isHidden()?this.showBundleButtonHtml:this.hideBundleButtonHtml;return this.bundleHtml.format(this.bundleName,this.bundleName.escapeHTML(),this.id,d,this.length(),c,this.makeLinkHtml.format((this.isShared())?"hidden":""),this.hotkeyId,this.isSynced()||this.isShared()?"":this.pushBundleButtonHtml,a,this.isNewlyUpdated?"":"hidden",this.toggleAutosaveHtml,this.downloadBundleCsvHtml)});Bundle.method("rename",function(b){var c=this;var a=this.uber("updateName",b,undefined,function(d){Popup.show(Messages.GeneralErrorTitle,Messages.SynchronizationError.format(c.bundleName))},function(d){d.equals(Failure.DuplicateName)?Popup.show(d.title,d.message.format(b)):false;c.$bundle.html($($.parseHTML(c.makeHtml())).html());c.$bundle.attr("chosen","false");c.assignEvents()})});Bundle.method("toggleHide",function(){var b=this;var a=this.uber("hide",function(){b.removeFromDom();b.$bundle.find(".toggle-hide").changeClass("hide-bundle","show-bundle");$(document).trigger("tb-hide",b.bundleName)},function(){},function(){Popup.show(Messages.GeneralErrorTitle,Messages.HideFailure.format(b.bundleName))});if(!a){this.uber("unhide",function(){b.removeFromDom();b.$bundle.find(".toggle-hide").changeClass("show-bundle","hide-bundle");$(document).trigger("tb-unhide",b.bundleName)},function(){},function(){Popup.show(Messages.GeneralErrorTitle,Messages.UnhideFailure.format(b.bundleName))})}});Bundle.method("removeFromDom",function(){$("#{0}".format(this.id)).remove()});Bundle.method("remove",function(a,b){this.removeFromDom();if(!b){Autosave.removeBundle(this.bundleName);Autosave.removeTarget(this.bundleName)}this.uber("remove",a)});Bundle.method("loadBundle",function(b,a){var c=this;b=b||false;Browser.getCurrentTabList(function(m,n){var f=true;for(var g=0;g<m.length&&f;g++){f=m[g].url==="chrome://newtab/"}var l=f||Options.isset(Options.CloseCurrentOnOpen);var e={};e.top=0;e.left=0;if(!Options.isset(Options.OpenMinimized)){e.height=screen.height;e.width=screen.width}else{e.height=screen.height/2;e.width=screen.width/2}var j=c.tabs.map(function(i){return i.isPinned==1?undefined:i.url});var k=PinnedTabsHandler.get(m);var h=c.tabs.map(function(i){return i.isPinned==1&&(!PinnedTabsHandler.exists(i.url)||!Options.isset(Options.KeepPinnedTabs))?i.url:undefined});if(Options.isset(Options.KeepPinnedTabs)){h=h.concat(k)}TBAccessor.updateLastOpen(c.bundleName);if(Options.isset(Options.OpeningABundlePushesToTop)){TBAccessor.moveBundle(c.bundleName,-1)}if(a){Browser.createInCurrentWindow(j,h)}else{var d=Autosave.getWindowId(c.bundleName);if(d>-1&&Options.isset(Options.FocusOnWindowIfOpened)){chrome.windows.update(d,{focused:true})}else{Browser.create(j,b,h,function(i){Autosave.addBundle(i.id,c.bundleName);l?Browser.closeWindow(n):false;Badge.setWindowBadge(i.id)},e)}}})});Bundle.method("updateLinks",function(a){if(!this._isNewBundle()){var b=this;this.uber("updateLinks",function(){$("#upgrade").click();Popup.show(Messages.BundleLimitExceededTitle,Messages.BundleLimitExceeded,10000)},function(){b.$bundle.find(".bundle_icon").addClass("is-synced");b.$bundle.find(".make-link").show();a?a():false},function(c){Popup.show(Messages.GeneralErrorTitle,c.message)},undefined,undefined,function(c){Popup.show(Messages.GeneralErrorTitle,c.message)})}});Bundle.method("updateBundleLengthDisplayed",function(){this.$bundle.find(".bundle_length").html(this.length())});Bundle.method("addTabNumbersFromCurrentWindow",function(c){var d=this;var a=c.split(",");var b=[];Browser.getCurrentTabList(function(e){var f="Are the following tabs what you wanted to add to {0}?\n\n".format(d.bundleName);for(var h=0,j=e[a[h]-1];h<a.length;j=e[a[++h]-1]){if(j){var g=j.url;j=new Tab(j.title?j.title:getHostname(g),g,d,j.pinned);f+="{0}. {1}\n".format(a[h],j.title);b.push(j)}}if(Options.isset(Options.DontAskForConfirmation)||checkMac()||confirm(f)){d.addTabToBundleSetup(b,true)}})});Bundle.method("addTabToBundleSetup",function(a,b){var c=this;this.addTabs(a,b);this.updateBundleLengthDisplayed();a=isArray(a)?a:[a];a.map(function(d){c.$add_link_container.before(d.makeTabHTML());d.assignEvents()});if(this.isSynced()||this.isShared()){this.updateLinks()}});Bundle.method("makeDroppable",function(){var a=this;this.$bundle.find(".bundle").droppable({scope:"bundle",hoverClass:"droppable-hover",drop:function(e,f){var c=$(f.draggable).attr("bundleName");$('.bundle[name="{0}"]'.format(c)).attr("dropped","true");var b=$(f.draggable).attr("link");var g=$(f.draggable).attr("title");var d=$(f.draggable).attr("pinned")=="1";a.addTabToBundleSetup(new Tab(g,b,a,d),true);f.draggable.remove()}})});Bundle.method("createFillCB",function(){var a=this;return function(b){return Tab.apply(b,a)}});Bundle.method("dom",function(){return this.$bundle});Bundle.method("assignEvents",function(){var e=this;this.$bundle=$("#{0}".format(this.id));this.$add_link_container=this.$bundle.find(".add_link_container");this.makeDroppable();this.$bundle.rightClick(function(){var g={};if(e.isSynced()){g[ContextMenu.StopSyncing]=function(){e.stopSyncing()}}var f=e.isHidden()?ContextMenu.UnHideBundle:ContextMenu.HideBundle;g[f]=function(){e.toggleHide()};if(Autosave.isTarget(e.bundleName)){g[ContextMenu.UnAutosyncBundle]=function(){Autosave.removeTarget(e.bundleName)}}else{g[ContextMenu.AutosyncBundle]=function(){Autosave.addTarget(e.bundleName)}}g[ContextMenu.OpenInIncognito]=function(){e.loadBundle(true)};g[ContextMenu.OpenInSameWindow]=function(){e.loadBundle(true,true)};g[ContextMenu.OpenInNewWindow]=function(){e.loadBundle()};g[ContextMenu.CloseTabsFromBundle]=function(){var h=e.tabs.map(function(j){return j.url});var i=[];Browser.getCurrentTabList(function(j){j.map(function(k){if(h.indexOf(k.url)!==-1&&i.indexOf(k.id)===-1){i.push(k.id)}});Browser.removeTabs(i)})};ContextMenu.addMenuItems(g)});if(this.hotkeyId){var d=this.hotkeyId.split("").map(function(f){return"alt+{0}".format(f)}).join(" ");Mousetrap.bindGlobal([d],function(){e.loadBundle()})}this.$bundle.find(".autosave").click(function(){if($(this).hasClass("selected")){Autosave.removeTarget(e.bundleName)}else{Autosave.addTarget(e.bundleName)}$(e.$bundle.find(".autosave")).toggleClass("hidden")});this.$bundle.find(".remove").click(function(){if(Options.isset(Options.DontAskForConfirmation)||checkMac()){e.remove()}else{if(e.isSynced()){confirm(Messages.DeleteConfirmationSynced)?e.remove():false}else{confirm(Messages.DeleteConfirmation)?e.remove():false}}});this.$bundle.children(".link_title").click(function(){var f=$(this);f.attr("editing","true");f.removeAttr("readonly");f.blur(function(){f.attr("editing","false");f.prop("readonly");var g=f.val();TBAccessor.replaceLinkTitleInBundle(bundleName,e.url,e.title,g);bundle.updateLinks();e.update(g,e.url)});onEnter(f,function(g){f.blur()})});this.$bundle.find(".bundle").hover(function(){if(e.$bundle.attr("chosen")!=="true"){$(this).addClass("highlighted");$(this).children(".show, .icons").removeClass("hidden")}},function(){if(e.$bundle.attr("chosen")!=="true"){$(this).removeClass("highlighted");$(this).children(".show, .icons").addClass("hidden")}});this.$bundle.find(".hidden-icon-container div").hover(function(){$(this).find(".hidden-icon-label").show(500)},function(){$(this).find(".hidden-icon-label").hide(500)});this.$bundle.find(".bundle").click(function(){e.$bundle.children(".link_container").removeClass("hidden");var h=e.$bundle.find(".edit_highlight");if(h.attr("editing")=="false"){e.isShared()?false:e.$bundle.find(".bundle_name_edit").toggle();var g=e.$bundle.find(".show");g.removeClass("show");g.addClass("is-shown");e.$bundle.attr("chosen","true");h.attr("editing","true");h.removeClass("image");h.addClass("image_on_hover")}else{e.isShared()?false:e.$bundle.find(".bundle_name_edit").toggle();var f=e.$bundle.find(".is-shown");f.removeClass("is-shown");f.addClass("show");e.$bundle.attr("chosen","false");h.attr("editing","false");h.removeClass("image_on_hover");h.addClass("image");e.$bundle.children(".link_container").addClass("hidden")}});this.$bundle.find(".image").not(".link").hover(function(){if(!($(this).hasClass("edit_highlight")&&$(this).attr("editing")=="true")){$(this).removeClass("image");$(this).addClass("image_on_hover")}},function(){if(!($(this).hasClass("edit_highlight")&&$(this).attr("editing")=="true")){$(this).removeClass("image_on_hover");$(this).addClass("image")}});this.$bundle.find(".bundle_icon").mousedown(function(f){switch(f.which){case 1:e.loadBundle();break;case 2:e.loadBundle(true);break;case 3:e.loadBundle(false,true);break;default:Popup.show(Messages.GeneralErrorTitle,"User action not supported.")}});this.$bundle.find(".bundle_icon").dblclick(function(f){return false});this.$bundle.find(".bundle").dblclick(function(){var f=e.$bundle.find(".edit_highlight");if(f.attr("editing")=="false"){e.loadBundle()}});this.$bundle.find(".refresh").click(function(){(Options.isset(Options.DontAskForConfirmation)||checkMac()||confirm(Messages.RefreshConfirmation))?$(document).trigger("tb-refresh",e.bundleName):false});var c={".add_page":function(f){Browser.getCurrentTabList(function(h){var g=h[0].url;var i=new Tab(h[0].title?h[0].title:getHostname(g),g,e,h[0].pinned);e.addTabToBundleSetup(i,true)},{active:true})},".make-link":function(){if(Account.loggedIn()){if(e.isSynced()){$(document).trigger("share-bundle",e.bundleName)}else{e.updateLinks(function(){$(document).trigger("share-bundle",e.bundleName)})}}else{$(document).trigger("sign-up-page-event");Popup.show(Messages.MustBeLoggedInInLoginPageTitle,Messages.MustBeLoggedInInLoginPage,10000)}},".export-csv":function(g,f){downloadDataURI($,{filename:"{0}.csv".format(e.bundleName),data:"data:application/csv;charset=utf-8,{0}".format(encodeURIComponent(e.tabs.map(function(h){return"{0},{1}".format(h.title,h.url)}).join("\n")))})},".bundle_name_input":function(g,f){var h=f;h.removeAttr("readonly");Mousetrap.pause();h.blur(function(){h.prop("readonly");e.rename(h.val());Mousetrap.unpause()});h.onEnter(function(i){h.blur()})},".push":function(){if(Account.loggedIn()){e.updateLinks()}else{$(document).trigger("sign-up-page-event");Popup.show(Messages.MustBeLoggedInInLoginPageTitle,Messages.MustBeLoggedInInLoginPage,10000)}},".toggle-hide":function(){e.toggleHide()},".bundle_icon":function(){}};Object.keys(c).map(function(f){e.$bundle.find(f).click(function(g){c[f](g,$(this));return false})});this.$bundle.find(".bundle_name_input").val(e.bundleName);var a=this.$bundle.find(".input_link");a.setDefault();a.focus(function(){Mousetrap.pause()});a.blur(function(){Mousetrap.unpause()});a.onEnter(function(f){e.$add_link_container.find(".manual_add_page").trigger("click")});this.$add_link_container.find(".manual_add_page").click(function(h){var f=e.$add_link_container.children("input").val();if(f.toLowerCase().trim()=="all"){Browser.getCurrentTabList(function(k,j){k.map(function(l){l=new Tab(l.title,f,e,false);e.addTabToBundleSetup(l,true)})})}else{var i=f.replace(/,+/g,",").replace(/^,|,$| /g,"").match(/^[0-9]+(,[0-9]+(-[0-9]+)?)*$/);if(f!==e.$add_link_container.children("input").attr("default")){if(i){e.addTabNumbersFromCurrentWindow(i[0])}else{f=/http/.test(f)===false?"http://{0}".format(f):f;var g=new Tab(getHostname(f),f,e,false);e.addTabToBundleSetup(g,true)}}}});for(var b=0;b<this.tabs.length;b++){this.tabs[b].assignEvents()}});