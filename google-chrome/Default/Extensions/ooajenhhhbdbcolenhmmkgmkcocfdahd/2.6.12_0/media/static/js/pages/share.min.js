function SharePage(a,b){var d=this;this._init("#share-container",".tb-page","#tab-bundler-container",a,b,true);var c=EmailListHandler.getAll();this.collaborateEmailList=ListJS($("#collaborate-email"),$("#add-collaborate-email"),$("#collaborate-email-container"),{maximum:10,typeahead:{suggestions:c,suggestion:function(e){if(e.name){return['<div class="search-result pointer">','<div class="tb-text">{0}</div>','<div class="mini-text">{1}</div>',"</div>"].join("\n").format(e.name,e.email)}else{return['<div class="search-result pointer">','<div class="tb-text">{0}</div>',"</div>"].join("\n").format(e.email)}},keys:["email","name"],displayKey:"email",name:"email"}});this.collaborateEmailList.start();this.link="";this.description="";this.bundle="";this.wheel=new Wheel("#share-wheel");this.shareFunctions={"view-only":function(j,f,g,i,h,e){Share.shareLink(j,f,g,i,h,e)},edit:function(j,f,g,i,h,e){SubscriptionHandler.collaborate(j,f,g,i,h,e)}};this.shareMessages={"view-only":{error:Messages.ShareError,success:Messages.ShareSuccess},edit:{error:Messages.CollaborationError,success:Messages.CollaborationSuccess}};this.mode="view-only"}SharePage.inherits(Page);SharePage.method("addEmails",function(){var b=this;var a=this.collaborateEmailList.getResults();EmailListHandler.addEmails(a);a.map(function(d,c){b.addToAutocomplete(c)})});SharePage.method("toggle",function(a,b){var c=this;this.uber("_toggle",function(){c.share(b);Mousetrap.pause()},function(){Mousetrap.unpause()})});SharePage.method("fillData",function(d){var c=d.link;if(c!==undefined){this.link=c;var a=this._makeFullLink(c);$("#full-link").attr("href",a).text(a);$("#path-container").val(c);$("#username-container").text(Account.username())}var b=d.description;if(b!==undefined){if(b){$("#description").text(b);$("#description-input").val(b)}else{$(".description-container").toggle();$("#description-input").val("")}}});SharePage.method("updateLink",function(a){var b=this;if(a!==b.link){Share.editLink(Account.id(),Account.key(),b.bundle,a,function(c){b.fillData(c)},function(c){Popup.show(Messages.GeneralErrorTitle,Messages.CouldNotUpdateLink)})}});SharePage.method("addToAutocomplete",function(a){this.collaborateEmailList.addSuggestions(a)});SharePage.method("updateDescription",function(a){var b=this;if(a!==b.description){Share.editDescription(Account.id(),Account.key(),b.bundle,a,function(c){b.fillData(c)},function(c){Popup.show(Messages.GeneralErrorTitle,Messages.CouldNotUpdateLink)})}});SharePage.method("share",function(a){var b=this;this.bundle=a;Share.getBundleData(Account.id(),Account.key(),a,function(c){b.fillData(c)},function(c){Popup.show(Messages.GeneralErrorTitle,Messages.CouldNotGetBundleData)})});SharePage.method("start",function(){var a=this;$(".data-toggler").click(function(){$(".{0}".format($(this).attr("toggle"))).toggle();$("#{0}".format($(this).attr("focus"))).focus()});$("#path-container").onEnter(function(){$("#path-container").trigger("blur")});$("#path-container").blur(function(b,c){a.updateLink($(this).val());$("#path-container:visible").length?$(".link-container").toggle():false});$("#description-input").blur(function(b,c){a.updateDescription($(this).val());$("#description-input:visible").length?$(".description-container").toggle():false});$("#full-link").click(function(){Browser.open($(this).attr("href"))});$("#submit-share").click(function(){a.wheel.start();a.addEmails();var b=a.shareMessages[a.mode];a.shareFunctions[a.mode](Account.id(),Account.key(),a.link,a.collaborateEmailList.getResults(),function(){a.wheel.stop();Popup.show("Success",b.success,6000);a.toggle()},function(c){a.wheel.stop();Popup.show("Error",b.error,6000);a.toggle()})});$("#collaborate-type").change(function(){a.mode=$(this).val();$(".collaborate-type-text").hide();$(".{0}-text".format(a.mode)).show()});$("#description-input").setDefault();$("#cancel-share").click(function(){a.collaborateEmailList.reset()})});SharePage.method("_makeFullLink",function(a){return Server.getPath("/{0}/{1}".format(Account.username(),a))});var sharePage=new SharePage(".share-page-toggler","share-bundle");