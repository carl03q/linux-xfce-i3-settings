var host = "http://chromeshutter.appspot.com"; var snapshotName; var lastTabIds = new Array(); var lastTabUrls = new Array(); function genId() { var a = new Date; return a.getTime() } function getWindows(a) { chrome.tabs.getAllInWindow(a.id, getTabs) } function getTabs(a) { saveCurrentWinTabs(a) } function saveCurrentWinTabs(c) { var f = ""; var g = genId(); var b = snapshotName; var e = c.length; for (var a = 0; a < e; a++) { var d = c[a]; f += d.url + "@,@" } if (f.length > 2) { f = f.substring(0, f.length - 3) } addTabUrl(g, f, b, "add") } function addSelectedTabs(b, a) { snapshotName = b; var c = function (e) { var h = ""; var g = e.length; var i = genId(); for (var d = 0; d < g; d++) { var f = e[d]; h += f.url + "@,@" } if (h.length > 2) { h = h.substring(0, h.length - 3) } addTabUrl(i, h, snapshotName, "add") }; if (a) { chrome.tabs.query({ highlighted: a, currentWindow: true }, c) } else { chrome.tabs.query({ currentWindow: true }, c) } } function updateTabs(a) { chrome.tabs.query({ currentWindow: true }, function (c) { var f = ""; var e = c.length; for (var b = 0; b < e; b++) { var d = c[b]; f += d.url + "@,@" } if (f.length > 2) { f = f.substring(0, f.length - 3) } addTabUrl(a, f, name, "refresh") }) } function appendSelectedTabs(a) { chrome.tabs.query({ highlighted: true, currentWindow: true }, function (c) { var f = ""; var e = c.length; for (var b = 0; b < e; b++) { var d = c[b]; f += d.url + "@,@" } if (f.length > 2) { f = f.substring(0, f.length - 3) } addTabUrl(a, f, name, "append") }) } function saveAllWinTabs(l) { var k = l.length; var h = ""; var b = genId(); var a = snapshotName; for (var f = 0; f < k; f++) { var g = l[f]; var d = g.tabs.length; for (var e = 0; e < d; e++) { var c = g.tabs[e]; addTabUrl(b, c.url, a, "add") } } } function openTabs(d) { var a = d.split("@,@"); var b; for (var c = 0; c < a.length; c++) { b = a[c]; chrome.tabs.create({ url: b }) } } function addTabUrl(f, b, a, d) { var c; c = new XMLHttpRequest(); var e = "name=" + a + "&id=" + f + "&u=" + encodeURIComponent(b.toString()); if (d == "append") { e += "&append=1" } if (d == "refresh") { e += "&refresh=1" } c.open("POST", host + "/snapshot/add", true); c.setRequestHeader("Content-type", "application/x-www-form-urlencoded"); c.onreadystatechange = function () { if (c.readyState == 4) { if (c.status == 200) { animShutter(); var k = chrome.extension.getURL("popup.html"); var h = chrome.extension.getViews({ type: "popup" }); for (var j = 0; j < h.length; j++) { if (h[j].location.href == k) { var g = h[j]; if (c.responseXML != null) { if (c.responseXML.getElementsByTagName("msg")[0]) { g.showTabs(c); return } } } } g.requestXml(c.status) } else { g.showInternalMsg() } } }; c.send(e) } function animShutter() { setTimeout(function () { chrome.browserAction.setIcon({ path: "icon322.png" }) }, 200); setTimeout(function () { chrome.browserAction.setIcon({ path: "icon323.png" }) }, 400); setTimeout(function () { chrome.browserAction.setIcon({ path: "icon322.png" }) }, 900); setTimeout(function () { chrome.browserAction.setIcon({ path: "icon32.png" }) }, 1100) } chrome.omnibox.onInputEntered.addListener(function (a) { addSelectedTabs(a, false) });