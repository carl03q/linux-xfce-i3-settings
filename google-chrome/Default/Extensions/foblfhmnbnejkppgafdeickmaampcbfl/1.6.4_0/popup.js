var host="http://chromeshutter.appspot.com";var expandedId="";var scrollTop=0;function getDomain(a){try{return a.match(/:\/\/(.[^/]+)/)[1]}catch(b){return"(unknown domain)"}}function colapseNode(e){var c=document.getElementById("snap"+e);if(!c){return}if(c.getAttribute("expanded")=="true"){var a=document.getElementById("btnmenu"+e);a.style.display="none";c.className="snap";var d=document.getElementById("exp"+e);d.style.backgroundPosition="0";var b=document.getElementById("entry"+e);b.parentNode.removeChild(b);c.setAttribute("expanded","false");expandedId=""}}function toggleNode(c){var a=document.getElementById("snap"+c);if(!a){return}var b=a.getAttribute("expanded");if(b=="true"){colapseNode(c)}else{expandNode(c)}}function toggleDropDownBtn(d){var a=document.getElementById("btnmenu"+d);var c=document.getElementById("snap"+d);var b=getCheckedIndexes(c);if(b.length>0){a.style.display="block"}else{a.style.display="none"}}function expandNode(c){var d=document.getElementById("snap"+c);if(!d){return}var g=expandedId;if(g.length>1&&c!=g){colapseNode(g)}d.setAttribute("expanded","true");d.className="snap expanded";var h=d.getAttribute("urls");var p=h.split("@,@");var q=document.getElementById("exp"+c);q.style.backgroundPosition="-14px";var b=document.createElement("div");b.className="entry";b.id="entry"+c;var o="";for(var e=0;e<p.length;e++){o=p[e];var n=document.createElement("div");n.className="entry-box";var f=document.createElement("input");f.setAttribute("type","checkbox");f.setAttribute("url",o);f.name="chkurl";f.addEventListener("click",function(){toggleDropDownBtn(c)});n.appendChild(f);var m=document.createElement("div");m.className="title";m.style.backgroundImage="url('http://www.google.com/s2/favicons?domain= "+getDomain(o)+"')";var l=document.createElement("a");l.title=o;l.innerHTML=getDomain(o);l.target="_blank";l.addEventListener("click",openTabHandler(o));var j=document.createElement("button");j.title="Remove from snapshot";var k=e;j.addEventListener("click",removeUrlHandler(c,e));j.className="trash";m.appendChild(l);n.appendChild(j);n.appendChild(m);b.appendChild(n)}d.appendChild(b);expandedId=c}function removeUrlHandler(b,a){return function(){removeUrl(b,a.toString())}}function openTabHandler(a){return function(){openTab(a)}}function getUrlsFromIndexes(g,d){var e=document.getElementById("snap"+g);var f=e.getAttribute("urls");var a=f.split("@,@");f="";var c;for(var b=0;b<d.length;b++){c=d[b];f+=a[c]+"@,@"}if(f.length>2){f=f.substring(0,f.length-3)}return f}function getUrlsExceptIndexes(h,d){var f=document.getElementById("snap"+h);var g=f.getAttribute("urls");var a=g.split("@,@");g="";var e=0;var c="";for(var b=0;b<a.length;b++){c=a[b];if(b!=d[e]){g+=a[b]+"@,@"}else{e++}}if(g.length>2){g=g.substring(0,g.length-3)}return g}function removeUrl(e,c){var a=c.split(",");var d=getUrlsExceptIndexes(e,a);saveCurrentPos();var b=chrome.extension.getBackgroundPage();b.addTabUrl(e,d,"","refresh")}function saveCurrentPos(){var a=document.getElementById("snapsList");scrollTop=a.scrollTop}function loadCurrentPos(){var a=document.getElementById("snapsList");if(expandedId){expandNode(expandedId)}if(a!=null){a.scrollTop=scrollTop}}function initHintTextboxes(){var a=document.getElementById("snapshotName");a.focus();a.hintText=a.value;a.className="hintTextbox";a.onfocus=onHintTextboxFocus;a.onblur=onHintTextboxBlur}function initTakeSnapBtn(){var c=document.getElementById("snapshotName");c.addEventListener("keypress",function(){keyPressed(event)});var b=document.getElementById("takeSnapshot");b.addEventListener("click",function(){iceTabs(false)});var d=document.createElement("button");d.className="toptoolbar";d.id="btnTakeSnap";d.innerHTML="<div>Highlighted</div>";d.addEventListener("click",function(){iceTabs(true)});b.parentNode.appendChild(d)}function onHintTextboxFocus(){var a=document.getElementById("snapshotName");if(a.value==a.hintText){a.value="";a.className="hintTextboxActive"}}function onHintTextboxBlur(){var a=document.getElementById("snapshotName");if(a.value.trim().length==0){a.value=a.hintText;a.className="hintTextbox"}}function showTabs(k){if(k.responseXML==null){return}var e=document.getElementById("frame");removeInsideTag(e);var j=document.createElement("div");j.className="snaps";j.id="snapsList";var n=k.responseXML.getElementsByTagName("msg");if(n!=null&&typeof n!="undefined"){var d;for(var f=0,d;f<n.length;f++){d=n[f];showMsg(e,d)}}var b=k.responseXML.getElementsByTagName("snapshot");if(b[0]!=null&&typeof b!="undefined"){e.appendChild(j);for(var f=0,d;d=b[f];f++){drawSnapshot(j,d)}}var m=k.responseXML.getElementsByTagName("signin");if(m[0]!=null&&typeof m!="undefined"){var l=document.createElement("a");l.href=m[0].getAttribute("href");l.innerHTML="Sign In";l.target="_blank";l.className="signin-box";var h=document.getElementById("keyin");removeInsideTag(h);h.innerHTML="Welcome, <b>Tab Shutter</b> is integrated with your Google account.<br><br>";e.appendChild(l)}var p=k.responseXML.getElementsByTagName("signout");if(p[0]!=null&&typeof p!="undefined"){var l=document.createElement("button");l.addEventListener("click",function(){signOut(p[0].getAttribute("href"))});l.innerHTML="Sign Out";l.className="signout";e.appendChild(l)}var c=k.responseXML.getElementsByTagName("toolbar");if(c[0]!=null&&typeof c!="undefined"){var g=document.createElement("ul");g.className="toolbar";for(var f=0,d;d=c[f];f++){var o=document.createElement("li");var l=document.createElement("a");l.href=d.getAttribute("href");l.target="parent";l.innerHTML=d.getAttribute("value");l.title=d.getAttribute("caption");o.appendChild(l);g.appendChild(o)}e.appendChild(g)}loadCurrentPos()}function drawSnapshot(k,f){var m=document.createElement("div");m.className="snap";m.id="snap"+f.getAttribute("id");f.setAttribute("expanded","false");m.setAttribute("urls",f.getAttribute("url"));k.appendChild(m);var o=document.createElement("a");var g=document.createElement("button");g.className="expander";g.setAttribute("name","expandbtn");g.id="exp"+f.getAttribute("id");g.addEventListener("click",function(){toggleNode(f.getAttribute("id"))});m.appendChild(g);var b=f.getAttribute("id");var c=document.createElement("div");c.className="dropboxmenu";c.id="menu"+b;c.setAttribute("name","dropboxmenu");var d=document.createElement("button");d.className="drop-down";d.setAttribute("name","dropboxbtn");d.style.display="none";d.id="btn"+c.id;d.addEventListener("click",function(){showDropbox(c.id)});m.appendChild(d);m.appendChild(c);d=document.createElement("button");d.className="tinybtn removebtn";d.id="btnRemove";d.title="Remove Snapshot";d.addEventListener("click",function(){confirmSnapshot(b)});m.appendChild(d);d=document.createElement("button");d.className="tinybtn sharebtn";d.id="btnShare";d.title="Share url(s) on Gmail";var i=f.getAttribute("url");d.addEventListener("click",function(){sendToGmail(i)});m.appendChild(d);d=document.createElement("button");d.className="tinybtn updatebtn";d.id="btnUpdate";d.title="Update snapshot with current tabs";d.addEventListener("click",function(){updateSnapshot(b)});m.appendChild(d);d=document.createElement("button");d.className="tinybtn AddHighlitedbtn";d.id="btnappend";d.title="Add Highlighted Tab(s)";d.addEventListener("click",function(){appendTabs(b)});m.appendChild(d);d=document.createElement("button");d.className="tinybtn newwinbtn";d.title="Open Tabs In New Window";d.id="btnnewwin";d.addEventListener("click",function(){openTabs(true,b)});m.appendChild(d);var p=f.getAttribute("date");var e=new Date(p).toLocaleString();e=e.substr(0,e.indexOf("GMT"));var l=document.createElement("button");l.innerHTML=f.getAttribute("Title");l.id="title"+f.getAttribute("id");l.addEventListener("click",function(){openTabs(false,f.getAttribute("id"))});l.urls=f.getAttribute("url");m.appendChild(l);var n=document.createElement("span");n.innerHTML=f.getAttribute("user");m.appendChild(n);var h=document.createElement("span");h.innerHTML="("+f.getAttribute("url").split("@,@").length+" Tabs)";h.className="badge";var j=document.createElement("div");j.innerHTML="<div class='date'>"+e+"</div>";j.appendChild(h);m.appendChild(j)}function getCheckedIndexes(d){if(d.getAttribute("expanded")=="true"){var a="";var e=document.getElementsByName("chkurl");for(var b=0,f;f=e[b];b++){if(f.checked){a+=b+","}}if(a.length>1){a=a.substring(0,a.length-1)}return a}return null}function createDropbox(a,c){var d=c.parentNode;if(a!="keyin"){var h=getCheckedIndexes(d);if(h){var f=document.createElement("a");f.innerHTML="<img src='null.png' title='Open selected items' ><span>Open selected items</span>";f.addEventListener("click",function(){openSelectedTabs(false,a,h)});f.className="item";c.appendChild(f);var b=document.createElement("div");b.className="devider";c.appendChild(b);var l=document.createElement("a");l.innerHTML="<img src='trash.png' title='Remove selected items' alt='remove' style='opacity:0.55'><span>Remove selected items...</span>";l.className="item";l.addEventListener("click",function(){confirmSelectedRemove(a,h)});c.appendChild(l);var b=document.createElement("div");b.className="devider";c.appendChild(b);var l=document.createElement("a");l.innerHTML="<img src='icon_email.gif' title='Send to email' alt='email' style='opacity:.55' ><span>Send selected to email...</span>";l.className="item";var g=h.split(",");l.addEventListener("click",function(){sendToGmail(getUrlsFromIndexes(a,g))});c.appendChild(l);return}var e=document.createElement("a");e.innerHTML="<img  src='newwindow.gif' title='Open in new window'  /><span>Open in new window</span>";e.addEventListener("click",function(){openTabs(true,a)});e.className="item";c.appendChild(e);var b=document.createElement("div");b.className="devider";c.appendChild(b);var i=document.createElement("a");i.innerHTML="<img src='add.gif' title='Add selected Tabs to this Snapshot' alt='Append' style='opacity:0.55'><span>Add highlighted tabs</span>";i.className="item";i.addEventListener("click",function(){appendTabs(a)});c.appendChild(i);var k=document.createElement("a");k.innerHTML="<img src='update.png' title='Update this Snapshot' alt='Update' style='opacity:0.75'  ><span>Update snapshot</span>";k.className="item";k.addEventListener("click",function(){updateSnapshot(a)});c.appendChild(k);var l=document.createElement("a");l.innerHTML="<img src='trash.png' title='Remove this Snapshot' alt='remove' style='opacity:0.55'><span>Remove snapshot...</span>";l.className="item";l.addEventListener("click",function(){confirmSnapshot(a)});c.appendChild(l);var b=document.createElement("div");b.className="devider";c.appendChild(b);var l=document.createElement("a");l.innerHTML="<img src='icon_email.gif' title='Send to email' alt='email' style='opacity:.55' ><span>Send to email...</span>";l.className="item";var j=d.getAttribute("urls");l.addEventListener("click",function(){sendToGmail(j)});c.appendChild(l)}else{var i=document.createElement("a");i.innerHTML="<img src='add.gif' title='Add hilighted Tabs' alt='Append' style='opacity:0.55'><span>Add highlighted tabs</span>";i.className="item";i.addEventListener("click",function(){iceTabs(true)});c.appendChild(i)}}function sendToGmail(b){var a="mailto:?subject=Check out links&body=";b="Please check out following link(s):"+encodeURIComponent("\n\t"+b.replace(/@,@/gi,"\n\t"));a+=b;window.open(a)}function hideDropbox(k){var g=document.getElementsByName("dropboxmenu");var j=document.getElementsByName("dropboxbtn");var d=-1;for(var f=0,c,a;c=g[f];f++){a=j[f];var h=k?k.target:event.srcElement;if(h==a){d=f}}if(d<0){for(var f=0,c;c=g[f];f++){c.style.visibility="hidden"}}}document.onclick=hideDropbox;function showDropbox(a){var d=document.getElementById(a);var e=d.parentNode;var g=document.getElementById("btn"+a);var h=document.getElementsByName("dropboxmenu");var c=document.getElementsByName("dropboxbtn");if(d!=null){for(var j=0,f,k;f=h[j];j++){k=c[j];f.innerHTML="";f.style.visibility="hidden"}var a=e.id.replace("snap","");createDropbox(a,d);d.style.visibility="visible"}}function requestNotification(){var a=new XMLHttpRequest();a.open("GET",host+"/notify",true);a.onreadystatechange=function(){if(a.readyState>3){if(a.status==200){showNotify(a);return true}}};a.send(null)}function showNotify(h){if(h.responseXML==null){return}var c=h.responseXML.getElementsByTagName("notify");var j=document.getElementById("notification");if(j!=null){j.innerHTML="";for(var f=0,d;d=c[f];f++){var e=document.createElement("div");e.setAttribute("id","notify"+d.getAttribute("id"));var b=document.createElement("div");b.addEventListener("click",function(){closeNotify(d.getAttribute("id"))});b.className="close";e.appendChild(b);var a=document.createElement("span");a.innerHTML=d.getAttribute("body");e.appendChild(a);var g=d.getAttribute("type");if(g=="warning"){e.className="notify warning"}if(g=="critical"){e.className="notify critical"}if(g=="info"){e.className="notify info"}if(g=="facebook"){e.className="notify facebook"}if(g=="gplus"){e.className="notify gplus"}e.style.display="block";j.appendChild(e)}}}function signOut(a){var b=new XMLHttpRequest();b.open("POST",a,true);b.onreadystatechange=function(){if(b.readyState==4){window.close()}};b.send(null)}function openTabs(b,d){saveCurrentPos();if(b){win=chrome.windows.create()}var c=chrome.extension.getBackgroundPage();var a=document.getElementById("snap"+d);c.openTabs(a.getAttribute("urls"))}function openTab(a){var b=chrome.extension.getBackgroundPage();b.openTabs(a)}function openSelectedTabs(a,e,d){saveCurrentPos();if(a){win=chrome.windows.create()}var c=chrome.extension.getBackgroundPage();var b=d.split(",");c.openTabs(getUrlsFromIndexes(e,b))}function iceTabs(a){scrollTop=0;var b=chrome.extension.getBackgroundPage();b.addSelectedTabs(document.getElementById("snapshotName").value,a)}function appendTabs(b){saveCurrentPos();var a=chrome.extension.getBackgroundPage();a.appendSelectedTabs(b.toString())}function showMsg(f,h){if(f!=null&&h!=null){var j=document.createElement("div");j.innerHTML="<span>"+h.getAttribute("desc")+"</span>";var g=h.getElementsByTagName("button");if(g!=null){for(var d=0,c;c=g[d];d++){var b=document.createElement("a");b.href=c.getAttribute("href");b.innerHTML=c.getAttribute("caption");b.title=c.getAttribute("title");b.target=c.getAttribute("target");j.appendChild(b)}}j.id="msg"+h.getAttribute("id");var e=h.getAttribute("type");if(e=="warning"){j.className="WarningBox"}if(e=="critical"){j.className="criticalBox"}if(e=="info"){j.className="infoBox"}f.appendChild(j)}}function showInternalMsg(e){var d=document.getElementById("frame");removeInsideTag(d);if(d!=null){var f=document.createElement("div");f.innerHTML="<span>Unknown Error, please try again. Error Code: "+e+"</span>";var b=document.createElement("a");b.href="#";b.innerHTML="Close";b.title="";b.target="";f.appendChild(b);f.id="msgerror";var c=node.getAttribute("type");f.className="criticalBox";d.appendChild(f)}}function confirmSnapshot(e){var b=document.getElementById("snap"+e);if(b!=null){var d=document.createElement("div");var a=document.createElement("a");var c=document.createElement("a");a.addEventListener("click",function(){removeSnapshot(e)});a.innerHTML="Yes";c.addEventListener("click",function(){cancelRemoveSnapshot(e)});c.innerHTML="Cancel";d.id="confirm"+e;d.innerHTML="<span>Are you sure?</span>";d.appendChild(c);d.appendChild(a);d.className="RemoveBox";b.appendChild(d);return}}function confirmSelectedRemove(f,a){var c=document.getElementById("snap"+f);if(c!=null){var e=document.createElement("div");var b=document.createElement("a");var d=document.createElement("a");b.addEventListener("click",function(){removeUrl(f,a)});b.innerHTML="Yes";d.addEventListener("click",function(){cancelRemoveSnapshot(f)});d.innerHTML="Cancel";e.id="confirm"+f;e.innerHTML="<span>Are you sure?</span>";e.appendChild(d);e.appendChild(b);e.className="RemoveBox";c.appendChild(e);return}}function cancelRemoveSnapshot(c){var a=document.getElementById("snap"+c);if(a!=null){var b=document.getElementById("confirm"+c);if(b!=null){a.removeChild(b)}}}function updateSnapshot(b){saveCurrentPos();var a=chrome.extension.getBackgroundPage();a.updateTabs(b)}function removeSnapshot(c){var a=new XMLHttpRequest();a.open("POST",host+"/snapshot/remove",true);var b="id="+c;a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){requestXml();return true}}};a.send(b)}function removeSelectedUrls(b){var a=new XMLHttpRequest();a.open("POST",host+"/snapshot/remove",true);var c="id="+id;a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){requestXml();return true}}};a.send(c)}function init(){initHintTextboxes();initTakeSnapBtn();requestXml();requestNotification()}function removeInsideTag(a){if(a){if(a.hasChildNodes()){while(a.childNodes.length>=1){a.removeChild(a.firstChild)}}}}function requestXml(){var b=document.getElementById("frame");if(b){var c=document.createElement("span");c.innerHTML="<img src='upload.gif'/> Please wait...";c.className="loading";b.appendChild(c)}var a=new XMLHttpRequest();a.open("GET",host+"/snapshot",true);a.onreadystatechange=function(){if(a.readyState>3){if(a.status==200){showTabs(a);return true}}};a.send(null)}function keyPressed(a){if(a.keyCode==13){iceTabs(false)}}function closeNotify(d){var b=document.getElementById("notify"+d);if(b!=null){var a=new XMLHttpRequest();var c="id="+d;a.open("POST",host+"/notify/viewed?id="+d,true);a.onreadystatechange=function(){if(a.readyState>3){if(a.status==200){b.style.display="none";return true}}};a.send(null)}}document.addEventListener("DOMContentLoaded",function(){init()});var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-29986963-3"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src="https://ssl.google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();